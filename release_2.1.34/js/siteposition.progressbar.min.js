
(function(d){var b="test.php";var c=[{type:"ao",averageTime:20000},{type:"manual",averageTime:10000},{type:"report",averageTime:10000},{type:"big_report",averageTime:10000},{type:"proverka",averageTime:10000}];var a=function(h){try{d.extend(true,this,mfProgressBar.prototype);console.log(this);this.init(h);d(this).on("reciveData",this.onReciveData);var f=Math.floor(Math.random()*10000000);d(this.element).after('<span class="mon current" id="mon'+f+'cur"></span>');d(this.element).after('<span class="mon timeleft" id="mon'+f+'tl"></span>');this.monCurrent=d("#mon"+f+"cur");this.monTimeleft=d("#mon"+f+"tl");this.initializeAverageTime();if(this.autobegin){this.begin()}return this}catch(g){console.error(g)}};a.prototype={id:"",ch:"",type:"ao",redirect:"",url:"",isRunning:false,runHNDL:null,getDataInterval:3000,monCurrent:null,monTimeleft:null,startTime:0,endTime:0,questNum:0,actualQuest:-1,averageTime:10000,autobegin:false,onReciveData:function(h,g){this.questNum=parseInt(g.current[0]);g.current[1]=parseInt(g.current[1]);this.calculateTime(g);var f=100/this.questNum;this.actualQuest=g.current[1];this.setMonCurrent();if(g.current[0]!=g.current[1]){this.position(f*this.actualQuest+f,this.getDataInterval*1.5)}if(g.current[0]==g.current[1]){this.isRunning=false;this.position(100,100);this.setMonTimeLeft("Все задания выполнены за "+this.timeFormat(this.currentTime()-this.startTime));if(this.redirect.length>0){window.location.href=this.redirect}return}},calculateTime:function(f){if(this.actualQuest>0){this.averageTime=(f.timestamp-this.startTime)/this.actualQuest}if(!isNaN(this.averageTime)&&this.averageTime>0){var e=Math.floor(this.averageTime*(this.questNum-this.actualQuest));if(e!==Infinity&&!isNaN(e)){this.setMonTimeLeft("Осталось примерно "+this.timeFormat(e))}}},timeFormat:function(i){var k=i/1000,f=Math.floor((k/3600)%24),j=Math.floor((k/60)%60),e=Math.floor(k%60);function h(l){l=Math.floor(l);return l<10?"0"+l:l}var g="";if(f>0){g=g+h(f)+" час. "}if(j>0){g=g+h(j)+" мин. "}g=g+h(e)+" сек.";return g},setMonCurrent:function(e){if(!e){e="Завершено "+this.actualQuest+" из "+this.questNum+" заданий"}this.monCurrent.html(e)},setMonTimeLeft:function(e){if(!e){e="Вычисляю оставшееся время..."}this.monTimeleft.html(e)},setStyle:function(h,f){try{h.css(f)}catch(g){}},begin:function(){this.startTime=this.currentTime();this.actualQuest=-1;this.questNum=0;this.position(0);this.setMonTimeLeft("вычисляю оставшееся время");this.position(1);this.isRunning=true;this.getData();this.setMonCurrent();var g=this;try{clearInterval(this.runHNDL);this.runHNDL=setInterval(function(){if(g.isRunning){g.getData()}else{clearInterval(g.runHNDL);g.isRunning=false}},this.getDataInterval)}catch(f){}},getData:function(){try{var g=this;d.getJSON(this.url,{id:this.id,ch:this.ch,type:this.type,ci:this.actualQuest},function(e){d(g).trigger("reciveData",{current:e,timestamp:g.currentTime()})})}catch(f){}},currentTime:function(){var e=new Date();return e.getTime()}};a.prototype.initializeAverageTime=function(){try{for(var f=0;f<c.length;f++){if(c[f].type==this.type){this.averageTime=c[f].averageTime;return}}}catch(g){console.log(g)}};d.fn.spProgress=function(){try{var g=this;var f=arguments;if(!f.length){f={}}var h=null;var j=null;this.each(function(){try{if(typeof f==="object"&&!("owner" in this)){f[0].element=this;f[0].name="sp_progressbar_"+arguments[0];var k=new a(f[0],f[1])}}catch(m){console.warn(m)}try{if(typeof f[0]==="string"&&(f[0] in mfProgressBar||f[0] in mfProgressBar.prototype||f[0] in a.prototype)){if(!h){h=f[0]}if(!j){j=Array.prototype.slice.call(f,1)}var l=this.owner;if("function"===typeof mfProgressBar.prototype[f[0]]||"function"===typeof a.prototype[f[0]]){g=l[h].apply(l,j);return g}}}catch(m){console.warn(m)}})}catch(i){console.error(i)}return g}})(jQuery);